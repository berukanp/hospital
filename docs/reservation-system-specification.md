# 病院予約システム仕様書

## 1. システム概要

### 1.1 システム名
イークリニック予約システム

### 1.2 目的
患者が健康診断の予約をオンラインで行えるシステムを提供し、管理者が予約状況を効率的に管理できるようにする。

### 1.3 対象ユーザー
- **患者**: 健康診断の予約を行う一般ユーザー
- **管理者**: 予約状況の確認・管理を行うクリニックスタッフ

## 2. 機能仕様

### 2.1 認証機能

#### 2.1.1 ユーザーログイン
- **画面**: `/login`
- **機能**: メールアドレスとパスワードによるログイン
- **入力項目**:
  - メールアドレス（必須）
  - パスワード（必須）
- **バリデーション**:
  - 空欄チェック
  - メールアドレス形式チェック

#### 2.1.2 新規ユーザー登録
- **画面**: `/signup`
- **機能**: 新規患者アカウントの作成
- **入力項目**:
  - お名前（必須）
  - お名前カナ（必須）
  - 持っている保険証（必須）
  - 被保険者区分（本人/家族）（必須）
  - 協会けんぽ情報
  - 被保険者証番号
  - 保険者番号
  - 性別（必須）
  - 生年月日（必須）
  - 電話番号
  - メールアドレス（必須）
  - 語学力
  - 他の理解できる言語
  - パスワード（必須）
  - パスワード確認（必須）

#### 2.1.3 管理者ログイン
- **画面**: `/admin/login`
- **機能**: 管理者専用ログイン
- **認証情報**: admin@example.com / admin123

### 2.2 予約機能

#### 2.2.1 日付選択
- **画面**: `/calendar`
- **機能**: 予約日の選択
- **制限事項**:
  - 土日は選択不可
  - 過去の日付は選択不可
  - カレンダー形式で表示
- **注意事項モーダル**:
  - 予約後の流れ説明
  - 生活習慣病予防健診の便潜血検査について
  - 確認メール送信について

#### 2.2.2 健診コース選択
- **画面**: `/course-selection`
- **機能**: 健診コースとオプション検査の選択
- **健診コース**:
  1. 生活習慣病予防健診（便潜血検査必須）
  2. 定期健診
  3. 法定定期健診
  4. 雇用時健診
  5. 簡易健診
  6. 特定健診
  7. 電離放射線健診
  8. 長時間勤務健診

- **制限事項**:
  - 生活習慣病予防健診は14日以上先の日付のみ選択可能

#### 2.2.3 オプション検査選択
**A) 臓器がんが気になる方へ**
- 腫瘍マーカー男女共用(4種類) ¥5,610
- 腫瘍マーカー女性用(3種類) ¥4,400
- 腫瘍マーカー女性用(5種類) ¥7,480
- 腫瘍マーカー女性用(6種類) ¥8,910
- 腫瘍マーカー男性用(5種類) ¥7,260
- 腫瘍マーカー男性用(1種類) ¥2,530
- 腫瘍マーカー男女共用(1種類) ¥2,860

**B) 心臓の疾患が気になる方へ**
- 心不全 心臓機能 ¥3,300

**C) 胃・十二指腸の疾患が気になる方へ**
- 胃炎・胃潰瘍 十二指腸潰瘍(ABC分類) ¥4,400

**D) 肝炎感染が気になる方へ**
- B型・C型肝炎 ¥4,400

**E) HIV感染が気になる方へ**
- HIV感染 ¥2,200

**F) 甲状腺の疾患が気になる方へ**
- 甲状腺疾患 ¥4,510

**G) リウマチ疾患が気になる方へ**
- リウマチ疾患 ¥4,510

**H) アレルギーが気になる方へ**
- アレルギー (View 39) ¥17,600
- アレルギー (吸入系アレルギー6種類) ¥7,810

**I) 認知症が気になる方へ (要予約)**
- 認知症(アルツハイマー) MCIスクリーニング ¥30,000
- 認知症(アルツハイマー) APOE遺伝子 ¥30,000

**その他 オプション検査**
- 動脈硬化 ABI検査 ¥1,450
- 骨密度検査 ¥1,650
- 血液型検査 ¥2,000
- 胃部レントゲン検査 ¥10,450
- 腹部エコー(要予約) ¥6,050
- 頸部エコー(要予約) ¥2,200
- 眼底検査 ¥2,050
- 便潜血検査(要予約) ¥1,650
- 便培養検査(要予約) ¥2,000

**制限事項**:
- 便潜血検査は14日以上先の日付のみ選択可能

#### 2.2.4 時間選択
- **画面**: `/time-selection`
- **機能**: 予約時間の選択
- **時間帯**:
  - **午前**: 09:00, 09:30, 10:00, 10:30, 11:00, 11:30
  - **午後**: 15:30, 16:00, 16:30

#### 2.2.5 予約情報入力
- **画面**: `/reservation-input`
- **機能**: 会社名と備考の入力
- **入力項目**:
  - 会社名（必須）※個人の場合は「個人」と入力
  - 備考（任意）

#### 2.2.6 予約者情報確認
- **画面**: `/reservation-confirmation`
- **機能**: 予約内容と予約者情報の確認・編集
- **表示項目**:
  - 日付
  - 時間
  - 健診コース
  - 会社名
  - 備考
- **予約者情報**:
  - お名前（必須）
  - 電話番号（必須）
  - 住所（必須）
  - メールアドレス（必須）
- **機能**:
  - ユーザー登録データの自動入力
  - 情報変更時のユーザーデータ更新

#### 2.2.7 予約完了
- **画面**: `/reservation-complete`
- **機能**: 予約完了の表示
- **表示内容**:
  - 予約完了メッセージ
  - 予約日時
  - 予約者情報

### 2.3 予約管理機能

#### 2.3.1 マイ予約
- **画面**: `/my-reservations`
- **機能**: 自分の予約一覧表示
- **表示項目**:
  - 予約日時
  - 健診コース
  - オプション検査
  - 備考
  - 予約状況
- **操作**:
  - 予約キャンセル

#### 2.3.2 プロフィール編集
- **画面**: `/profile`
- **機能**: 登録情報の編集
- **編集可能項目**: 新規登録時と同じ項目

### 2.4 管理者機能

#### 2.4.1 管理者ダッシュボード
- **画面**: `/admin`
- **機能**: 予約状況の概要表示
- **表示内容**:
  - カレンダー形式の予約状況
  - 本日の予約一覧（午前・午後別）

#### 2.4.2 予約一覧管理
- **画面**: `/admin/reservations`
- **機能**: 全予約の一覧表示
- **表示項目**:
  - 予約日時
  - 予約者情報
  - 健診コース
  - オプション検査
  - 備考

#### 2.4.3 患者情報管理
- **画面**: `/admin/users`
- **機能**: 登録患者の一覧表示
- **表示項目**:
  - 名前
  - メールアドレス
  - 電話番号
  - 保険種別
  - 登録日

## 3. 技術仕様

### 3.1 フロントエンド
- **フレームワーク**: React 18.3.1
- **ルーティング**: React Router DOM 6.22.3
- **スタイリング**: Tailwind CSS 3.4.1
- **アイコン**: Lucide React 0.344.0
- **ビルドツール**: Vite 5.4.2

### 3.2 バックエンド
- **データベース**: Supabase
- **認証**: Supabase Auth
- **API**: Supabase JavaScript Client 2.39.7

### 3.3 デプロイメント
- **ホスティング**: Netlify
- **ビルドコマンド**: `npm run build`
- **出力ディレクトリ**: `dist`

## 4. データベース設計

### 4.1 主要テーブル
- **users**: ユーザー基本情報
- **patients**: 患者固有情報
- **courses**: 健診コース
- **time_slots_master**: 時間枠マスタ
- **appointments**: 予約情報
- **facility_settings**: 施設設定
- **default_closure_rules**: 定期休診ルール
- **special_closure_days**: 特別休診日

## 5. セキュリティ

### 5.1 認証・認可
- Supabase Authによるユーザー認証
- Row Level Security (RLS) による行レベルセキュリティ
- 管理者権限の分離

### 5.2 データ保護
- 個人情報の暗号化
- HTTPS通信の強制
- セッション管理

## 6. 運用・保守

### 6.1 バックアップ
- Supabaseによる自動バックアップ
- 定期的なデータエクスポート

### 6.2 監視
- エラーログの監視
- パフォーマンス監視
- セキュリティ監視

## 7. 今後の拡張予定

### 7.1 機能拡張
- メール通知機能
- SMS通知機能
- 予約変更機能
- 支払い機能

### 7.2 システム改善
- パフォーマンス最適化
- UI/UX改善
- モバイルアプリ対応

---

**作成日**: 2024年12月
**バージョン**: 1.0
**作成者**: システム開発チーム